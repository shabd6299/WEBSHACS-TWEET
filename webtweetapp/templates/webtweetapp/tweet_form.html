{% extends "webtweetapp/layout.html" %}

{% block title %}
  Webshacs Tweet
{% endblock title %}

{% block content %}
<div class="d-flex flex-column align-items-center justify-content-start" style="min-height: 100vh;">

    <!-- Heading at top center -->
    <div class="text-center mt-4 mb-4">
        <h1 style="font-size: 2.5rem; font-weight: bold;">Welcome to Webshacs Tweet</h1>
        <h2>
            {% if form.instance.pk %}
                Edit Tweet
            {% else %}
                Create Tweet
            {% endif %}
        </h2>
    </div>

    <!-- Centered form below heading -->
    <div class="card shadow-lg p-4" style="max-width: 600px; width: 100%; border-radius: 15px;">
        <form method="POST" enctype="multipart/form-data" class="text-center">
            {% csrf_token %}

            <!-- Tweet text block -->
            <div class="mb-3 text-start">
                <label class="form-label fw-bold">Text:</label>
                {{ form.text }}
            </div>

            <!-- Photo upload block -->
            <div class="mb-3 text-start">
                <label class="form-label fw-bold">Upload Photo</label>
                <div class="upload-box text-center p-4 border rounded"
                     style="border: 2px dashed #6c757d; cursor: pointer; position: relative;">
                    <p class="mb-1">ðŸ“· Drag & Drop your image here</p>
                    <p class="text-muted">or click to select</p>

                    {{ form.photo }}

                    <!-- Preview container -->
                    <div id="preview" class="mt-3"></div>
                </div>
            </div>

            <!-- Submit button -->
            <button type="submit" class="btn btn-primary mt-3 w-100">
                {% if form.instance.pk %}
                    Update Tweet
                {% else %}
                    Create Tweet
                {% endif %}
            </button>
        </form>
    </div>
</div>

<script>
    const uploadBox = document.querySelector(".upload-box");
    const input = document.getElementById("photoUpload");
    const preview = document.getElementById("preview");

    
    uploadBox.addEventListener("click", () => input.click());

    
    input.addEventListener("change", () => handleFiles(input.files));

    // Drag & drop behavior
    uploadBox.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadBox.style.backgroundColor = "#f8f9fa";
    });

    uploadBox.addEventListener("dragleave", () => {
        uploadBox.style.backgroundColor = "transparent";
    });

    uploadBox.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadBox.style.backgroundColor = "transparent";
        const files = e.dataTransfer.files;
        input.files = files;
        handleFiles(files);
    });

    // Handle preview
    function handleFiles(files) {
        preview.innerHTML = "";
        const file = files[0];
        if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = e => {
                const img = document.createElement("img");
                img.src = e.target.result;
                img.className = "img-fluid mt-2 rounded";
                img.style.maxHeight = "200px";
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    }
</script>
{% endblock content %}
